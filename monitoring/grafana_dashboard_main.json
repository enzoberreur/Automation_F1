{
  "dashboard": {
    "id": null,
    "uid": "ferrari-main-dashboard",
    "title": "F1 Multi-Team - Main Operations",
    "tags": [
      "ferrari",
      "ops",
      "main"
    ],
    "schemaVersion": 30,
    "version": 1,
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "templating": {
      "list": [
        {
          "type": "query",
          "name": "car_id",
          "label": "Car",
          "datasource": "Prometheus",
          "query": "label_values(ferrari_pitstop_score, car_id)",
          "current": {}
        },
        {
          "type": "interval",
          "name": "interval",
          "label": "Interval",
          "options": [
            {
              "text": "5m",
              "value": "5m"
            },
            {
              "text": "1h",
              "value": "1h"
            },
            {
              "text": "24h",
              "value": "24h"
            }
          ],
          "current": {
            "text": "1h",
            "value": "1h"
          }
        }
      ]
    },
    "panels": [
      {
        "id": 1,
        "type": "row",
        "title": "KPI Row",
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 0
        }
      },
      {
        "id": 2,
        "type": "stat",
        "title": "Current throughput (msg/s)",
        "gridPos": {
          "h": 3,
          "w": 4,
          "x": 0,
          "y": 1
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "sum(rate(ferrari_simulator_messages_sent_total[1m]))",
            "refId": "A"
          },
          {
            "expr": "ferrari_simulator_current_throughput_msg_per_sec",
            "refId": "B"
          }
        ],
        "options": {
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ]
          }
        }
      },
      {
        "id": 3,
        "type": "stat",
        "title": "Efficiency Index (Pitstop)",
        "gridPos": {
          "h": 3,
          "w": 4,
          "x": 4,
          "y": 1
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "avg_over_time(ferrari_pitstop_score[1h])",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "yellow",
                  "value": 50
                },
                {
                  "color": "red",
                  "value": 30
                }
              ]
            }
          }
        }
      },
      {
        "id": 4,
        "type": "stat",
        "title": "Engine temp (max \u00b0C)",
        "gridPos": {
          "h": 3,
          "w": 4,
          "x": 8,
          "y": 1
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "max_over_time(ferrari_simulator_engine_temp_celsius[5m])",
            "refId": "A"
          }
        ]
      },
      {
        "id": 5,
        "type": "stat",
        "title": "Active anomalies",
        "gridPos": {
          "h": 3,
          "w": 4,
          "x": 12,
          "y": 1
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "count(ferrari_active_anomalies) or vector(0)",
            "refId": "A"
          }
        ]
      },
      {
        "id": 6,
        "type": "stat",
        "title": "Fuel remaining (kg)",
        "gridPos": {
          "h": 3,
          "w": 4,
          "x": 16,
          "y": 1
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "ferrari_simulator_fuel_remaining_kg",
            "refId": "A"
          }
        ]
      },
      {
        "id": 7,
        "type": "row",
        "title": "Sparklines",
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 4
        }
      },
      {
        "id": 8,
        "type": "timeseries",
        "title": "Throughput 1h",
        "gridPos": {
          "h": 3,
          "w": 8,
          "x": 0,
          "y": 5
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "sum(rate(ferrari_simulator_messages_sent_total[1m]))",
            "refId": "A"
          }
        ],
        "options": {
          "tooltip": {
            "mode": "single"
          }
        }
      },
      {
        "id": 9,
        "type": "timeseries",
        "title": "Pitstop score 24h",
        "gridPos": {
          "h": 3,
          "w": 8,
          "x": 8,
          "y": 5
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "ferrari_pitstop_score",
            "refId": "A"
          }
        ]
      },
      {
        "id": 10,
        "type": "timeseries",
        "title": "Engine temp 1h",
        "gridPos": {
          "h": 3,
          "w": 8,
          "x": 16,
          "y": 5
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "ferrari_simulator_engine_temp_celsius",
            "refId": "A"
          }
        ]
      },
      {
        "id": 11,
        "type": "row",
        "title": "Service Health",
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 8
        }
      },
      {
        "id": 12,
        "type": "stat",
        "title": "sensor-simulator up",
        "gridPos": {
          "h": 2,
          "w": 6,
          "x": 0,
          "y": 9
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "up{job=\"sensor-simulator\"}",
            "refId": "A"
          }
        ]
      },
      {
        "id": 13,
        "type": "stat",
        "title": "stream-processor up",
        "gridPos": {
          "h": 2,
          "w": 6,
          "x": 6,
          "y": 9
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "up{job=\"stream-processor\"}",
            "refId": "A"
          }
        ]
      },
      {
        "id": 14,
        "type": "stat",
        "title": "prometheus up",
        "gridPos": {
          "h": 2,
          "w": 6,
          "x": 12,
          "y": 9
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "up{job=\"prometheus\"}",
            "refId": "A"
          }
        ]
      },
      {
        "id": 15,
        "type": "stat",
        "title": "grafana up",
        "gridPos": {
          "h": 2,
          "w": 6,
          "x": 18,
          "y": 9
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "up{job=\"grafana\"}",
            "refId": "A"
          }
        ]
      },
      {
        "id": 16,
        "type": "timeseries",
        "title": "Scrape duration (prometheus) / errors",
        "gridPos": {
          "h": 4,
          "w": 12,
          "x": 0,
          "y": 11
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "prometheus_tsdb_head_samples_appended_total or vector(0)",
            "refId": "A"
          },
          {
            "expr": "prometheus_scrape_samples_post_metric_relabeling_total or vector(0)",
            "refId": "B"
          }
        ]
      },
      {
        "id": 17,
        "type": "timeseries",
        "title": "Latency p50/p95/p99",
        "gridPos": {
          "h": 4,
          "w": 12,
          "x": 12,
          "y": 11
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "histogram_quantile(0.5, sum(rate(ferrari_simulator_send_latency_seconds_bucket[1m])) by (le))",
            "refId": "A"
          },
          {
            "expr": "histogram_quantile(0.95, sum(rate(ferrari_simulator_send_latency_seconds_bucket[5m])) by (le))",
            "refId": "B"
          },
          {
            "expr": "histogram_quantile(0.99, sum(rate(ferrari_simulator_send_latency_seconds_bucket[5m])) by (le))",
            "refId": "C"
          }
        ]
      },
      {
        "id": 18,
        "type": "heatmap",
        "title": "Latency heatmap",
        "gridPos": {
          "h": 6,
          "w": 12,
          "x": 0,
          "y": 15
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "sum(rate(ferrari_simulator_send_latency_seconds_bucket[5m])) by (le)",
            "refId": "A"
          }
        ]
      },
      {
        "id": 19,
        "type": "row",
        "title": "Thermal Cockpit",
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 21
        }
      },
      {
        "id": 20,
        "type": "timeseries",
        "title": "Brake temps (FL,FR,RL,RR)",
        "gridPos": {
          "h": 4,
          "w": 12,
          "x": 0,
          "y": 22
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "ferrari_simulator_brake_temp_fl_celsius",
            "refId": "A"
          },
          {
            "expr": "ferrari_simulator_brake_temp_fr_celsius",
            "refId": "B"
          },
          {
            "expr": "ferrari_simulator_brake_temp_rl_celsius",
            "refId": "C"
          },
          {
            "expr": "ferrari_simulator_brake_temp_rr_celsius",
            "refId": "D"
          }
        ]
      },
      {
        "id": 21,
        "type": "timeseries",
        "title": "Tire temps (FL,FR,RL,RR)",
        "gridPos": {
          "h": 4,
          "w": 12,
          "x": 12,
          "y": 22
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "ferrari_simulator_tire_temp_fl_celsius",
            "refId": "A"
          },
          {
            "expr": "ferrari_simulator_tire_temp_fr_celsius",
            "refId": "B"
          },
          {
            "expr": "ferrari_simulator_tire_temp_rl_celsius",
            "refId": "C"
          },
          {
            "expr": "ferrari_simulator_tire_temp_rr_celsius",
            "refId": "D"
          }
        ]
      },
      {
        "id": 22,
        "type": "stat",
        "title": "Tire wear avg (%)",
        "gridPos": {
          "h": 3,
          "w": 6,
          "x": 0,
          "y": 26
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "avg(ferrari_simulator_tire_wear_percent)",
            "refId": "A"
          }
        ]
      },
      {
        "id": 23,
        "type": "stat",
        "title": "Tire wear max (%)",
        "gridPos": {
          "h": 3,
          "w": 6,
          "x": 6,
          "y": 26
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "max(ferrari_simulator_tire_wear_percent)",
            "refId": "A"
          }
        ]
      },
      {
        "id": 24,
        "type": "timeseries",
        "title": "Brake temp delta (max-min)",
        "gridPos": {
          "h": 3,
          "w": 12,
          "x": 12,
          "y": 26
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "(max_over_time(ferrari_simulator_brake_temp_fl_celsius[5m]) or vector(0)) - (min_over_time(ferrari_simulator_brake_temp_fl_celsius[5m]) or vector(0))",
            "refId": "A"
          },
          {
            "expr": "(max_over_time(ferrari_simulator_brake_temp_fr_celsius[5m]) or vector(0)) - (min_over_time(ferrari_simulator_brake_temp_fr_celsius[5m]) or vector(0))",
            "refId": "B"
          }
        ]
      },
      {
        "id": 25,
        "type": "timeseries",
        "title": "Tire temp imbalance (max-min)",
        "gridPos": {
          "h": 3,
          "w": 12,
          "x": 0,
          "y": 29
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "(max_over_time(ferrari_simulator_tire_temp_fl_celsius[5m]) or vector(0)) - (min_over_time(ferrari_simulator_tire_temp_fl_celsius[5m]) or vector(0))",
            "refId": "A"
          }
        ]
      },
      {
        "id": 26,
        "type": "timeseries",
        "title": "Tire pressure imbalance (psi)",
        "gridPos": {
          "h": 3,
          "w": 12,
          "x": 12,
          "y": 29
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "(max_over_time(ferrari_simulator_tire_pressure_fl_psi[5m]) or vector(0)) - (min_over_time(ferrari_simulator_tire_pressure_fl_psi[5m]) or vector(0))",
            "refId": "A"
          }
        ]
      },
      {
        "id": 27,
        "type": "row",
        "title": "Projections & Recommendations",
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 32
        }
      },
      {
        "id": 28,
        "type": "timeseries",
        "title": "Tire wear projection (15m)",
        "gridPos": {
          "h": 4,
          "w": 12,
          "x": 0,
          "y": 33
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "avg_over_time(ferrari_simulator_tire_wear_percent[30m])",
            "refId": "A"
          },
          {
            "expr": "avg_over_time(ferrari_simulator_tire_wear_percent[30m]) + increase(ferrari_simulator_tire_wear_percent[30m]) / 1800 * 900",
            "refId": "B",
            "legendFormat": "projection_15m"
          }
        ]
      },
      {
        "id": 29,
        "type": "state-timeline",
        "title": "Strategy Recommendation Timeline",
        "gridPos": {
          "h": 4,
          "w": 12,
          "x": 12,
          "y": 33
        },
        "targets": [
          {
            "expr": "ferrari_simulator_strategy_recommendation_state",
            "legendFormat": "Recommendation",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "mappings": [
              {
                "options": {
                  "0": {
                    "text": "Extend"
                  },
                  "1": {
                    "text": "Evaluate"
                  },
                  "2": {
                    "text": "Pit soon"
                  }
                },
                "type": "value"
              }
            ],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "yellow",
                  "value": 0.5
                },
                {
                  "color": "red",
                  "value": 1.5
                },
                {
                  "color": "dark-red",
                  "value": 2.5
                }
              ]
            }
          }
        },
        "options": {
          "legend": {
            "displayMode": "hidden"
          }
        }
      },
      {
        "id": 30,
        "type": "timeseries",
        "title": "ERS power vs Engine temp",
        "gridPos": {
          "h": 4,
          "w": 12,
          "x": 0,
          "y": 37
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "ferrari_simulator_ers_power_kw",
            "refId": "A"
          },
          {
            "expr": "ferrari_simulator_engine_temp_celsius",
            "refId": "B"
          }
        ]
      },
      {
        "id": 31,
        "type": "timeseries",
        "title": "Lap Time & Pit Window",
        "gridPos": {
          "h": 4,
          "w": 12,
          "x": 12,
          "y": 37
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "ferrari_simulator_lap_time_seconds",
            "refId": "A",
            "legendFormat": "Lap time (s)"
          },
          {
            "expr": "ferrari_simulator_pit_window_probability * 100",
            "refId": "B",
            "legendFormat": "Pit window %"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Lap time (s)"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "s"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Pit window %"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "percent"
                }
              ]
            }
          ]
        },
        "options": {
          "legend": {
            "displayMode": "list",
            "placement": "bottom"
          }
        }
      },
      {
        "id": 32,
        "type": "table",
        "title": "Freshness (seconds since last sample)",
        "gridPos": {
          "h": 4,
          "w": 12,
          "x": 0,
          "y": 41
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "time() - timestamp(ferrari_simulator_current_throughput_msg_per_sec)",
            "refId": "A",
            "format": "table"
          },
          {
            "expr": "time() - timestamp(ferrari_simulator_engine_temp_celsius)",
            "refId": "B",
            "format": "table"
          }
        ]
      },
      {
        "id": 33,
        "type": "stat",
        "title": "Missing metrics (count)",
        "gridPos": {
          "h": 3,
          "w": 6,
          "x": 12,
          "y": 41
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "absent(ferrari_simulator_current_throughput_msg_per_sec)",
            "refId": "A"
          }
        ]
      },
      {
        "id": 34,
        "type": "stat",
        "title": "Cardinality (distinct cars)",
        "gridPos": {
          "h": 3,
          "w": 6,
          "x": 18,
          "y": 41
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "count(count by (car_id) (ferrari_pitstop_score))",
            "refId": "A"
          }
        ]
      },
      {
        "id": 35,
        "type": "table",
        "title": "Counter resets (1h)",
        "gridPos": {
          "h": 4,
          "w": 12,
          "x": 12,
          "y": 44
        },
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "resets(ferrari_simulator_messages_sent_total[1h])",
            "refId": "A",
            "format": "table"
          }
        ]
      },
      {
        "id": 36,
        "type": "row",
        "title": "Team comparison",
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 49
        }
      },
      {
        "id": 37,
        "type": "timeseries",
        "title": "Average speed by team",
        "datasource": "Prometheus",
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 50
        },
        "targets": [
          {
            "expr": "avg by (team) (ferrari_simulator_speed_kmh)",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "velocitykmh",
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "smooth",
              "lineWidth": 2,
              "showPoints": "auto"
            }
          },
          "overrides": []
        },
        "options": {
          "legend": {
            "displayMode": "table",
            "placement": "bottom"
          },
          "tooltip": {
            "mode": "multi"
          }
        }
      },
      {
        "id": 38,
        "type": "timeseries",
        "title": "Average tire wear by team",
        "datasource": "Prometheus",
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 50
        },
        "targets": [
          {
            "expr": "avg by (team) (ferrari_simulator_tire_wear_percent)",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "smooth",
              "lineWidth": 2,
              "showPoints": "auto"
            }
          },
          "overrides": []
        },
        "options": {
          "legend": {
            "displayMode": "table",
            "placement": "bottom"
          },
          "tooltip": {
            "mode": "multi"
          }
        }
      }
    ]
  },
  "overwrite": true
}
